(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{83970:function(e,t,n){Promise.resolve().then(n.bind(n,5202))},5202:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return AdminPage}});var a=n(52628),s=n(51966),u=n(43118),r=n(3107),i=n(51767),o=n(81943),l=n(6062),c=n(6194),d=n(42929),p=n(90947),m=n(78373),f=n(19532),v=n(15493),T=n(83508),b=n(45631),g=n(58409),x=n(85665),h=n(62531),B=n(35057),A=n(33737),P=n(11292),w=n(61766),y=n(58714);let k=[{label:"资产利息率",value:"Y"},{label:"目标AAR",value:"AART"},{label:"安全AAR",value:"AARS"},{label:"上顶AAR",value:"AARU"},{label:"熔断AAR",value:"AARC"},{label:"赎回手续费",value:"C"},{label:"进入国库比例",value:"TreasuryFeeRate"},{label:"Discount冷静时间",value:"CircuitBreakPeriod",units:0},{label:"低买池最小成交量USB",value:"PtyPoolMinUsbAmount"},{label:"高卖池最小成交量",value:"PtyPoolMinAssetAmount"},{label:"RateR",value:"RateR"}],S=[{label:"产品周期",value:"D",units:0},{label:"初始定价",value:"APRi"},{label:"赎回手续费",value:"f1"},{label:"利息佣金",value:"f2"}],V=[{label:"产品周期",value:"D",units:0},{label:"Nft质押Claim等待时间",value:"NftDepositLeadingTime",units:0},{label:"Nft赎回等待时间",value:"NftRedeemWaitingPeriod",units:0},{label:"初始定价",value:"APRi"},{label:"赎回手续费",value:"f1"},{label:"利息佣金",value:"f2"}],j=[{label:"产品周期",value:"ED",units:0},{label:"initialAnchor",value:"initialAnchor",units:18},{label:"scalarRoot",value:"scalarRoot",units:18},{label:"赎回手续费",value:"f1",units:18},{label:"利息佣金",value:"f2",units:18}];function UpdateVaultParams(e){let{paramList:t,vault:n,protocoSettingAddress:r}=e,o=(0,T.useMemo)(()=>t.map(e=>({...e,label:"".concat(e.label,"(").concat(e.value,")")})),[t]),[{value:l,param:c},d]=(0,g.Z)({value:"",param:o[0]}),{data:p,refetch:m}=(0,f.uX)({contracts:t.map(e=>({abi:i.$4,address:r,functionName:"vaultParamValue",args:[n,(0,h.$G)(e.value,{size:32})]}))}),P=(0,T.useMemo)(()=>(p||[]).map((e,n)=>{let a=t[n];return"".concat(a.label,"(").concat(a.value,"): ").concat((0,B.b)(e.result||0n,"number"==typeof a.units?a.units:10))}),[p]),w="number"==typeof c.units?c.units:10,[y,k]=(0,x.Z)();return(0,a.jsxs)(u.Ak,{tit:"Vault Param Vaule",children:[(0,a.jsx)(b.ZP,{classNames:u.At,maxMenuHeight:k.height+110,value:c,options:o,onChange:e=>d({param:e})}),(0,a.jsx)("input",{value:l.toString(),onChange:e=>{let t=(e.target.value||"").replaceAll("-","").replaceAll("+","");d({value:t})},type:"number",className:(0,v.cn)(u.pk),pattern:"[0-9.]{36}",step:1,placeholder:"0"}),(0,a.jsx)(s.v,{tx:"Write",config:{abi:i.$4,address:r,functionName:"updateVaultParamValue",args:[n,(0,h.$G)(c.value,{size:32}),(0,A.v)(l,w)]},onTxSuccess:()=>{d({value:""}),m()},className:" w-full flex items-center justify-center gap-4"}),(0,a.jsx)("div",{className:"text-sm flex flex-col items-start",ref:y,children:P.map((e,t)=>(0,a.jsx)("div",{children:e},"info_".concat(t)))})]})}function UpdateVaultPrice(e){let{vc:t}=e,[{feed:n},r]=(0,g.Z)({feed:""});return(0,a.jsxs)(u.Ak,{tit:"Vault Price Feed",children:[(0,a.jsx)("input",{type:"text",placeholder:"_assetTokenPriceFeed_",value:n,onChange:e=>r({feed:e.target.value}),className:(0,v.cn)(u.pk)}),(0,a.jsx)(s.v,{tx:"Write",config:{abi:i.WW,address:t.vault,functionName:"updatePriceFeed",args:[n]},onTxSuccess:()=>{r({feed:""})},className:" w-full flex items-center justify-center gap-4"})]})}function ClaimYieldsForBuyPool(e){let{vc:t}=e,{data:n}=(0,f.D2)({abi:i.aT,address:t.ptyPoolBelowAddress,functionName:"claimableYields"}),r=t.ptyPoolBelowAddress&&n||0n,[{address:o},l]=(0,g.Z)({address:""});return(0,a.jsxs)(u.Ak,{tit:"ClaimYields for Buy Low Pool",children:[(0,a.jsxs)("span",{children:["Yields: ",(0,P.d)(r)]}),(0,a.jsx)("input",{type:"text",placeholder:"recipient",value:o,onChange:e=>l({address:e.target.value}),className:(0,v.cn)(u.pk)}),(0,a.jsx)(s.v,{tx:"Write",disabled:!t.ptyPoolBelowAddress||r<=0n,config:{abi:i.aT,address:t.ptyPoolBelowAddress,functionName:"claimYields",args:[o]},className:"!mt-0  max-w-[100px] flex items-center justify-center gap-4"})]})}function SetTester(e){let{vc:t}=e,{data:n}=(0,f.D2)({abi:i.Og,address:t.assetTokenFeed,functionName:"getTestersCount"}),{data:r}=(0,f.D2)({abi:i.Og,address:t.assetTokenFeed,functionName:"owner"}),o=n||0n,{data:l}=(0,f.uX)({contracts:Array.from(Array(parseInt(o.toString()))).map((e,n)=>({abi:i.Og,address:t.assetTokenFeed,functionName:"getTester",args:[BigInt(n)]}))}),c=(null==l?void 0:l.map(e=>e.result))||[],[{address:d},p]=(0,g.Z)({address:""});return(0,a.jsxs)(u.Ak,{tit:"Set tester",children:[(0,a.jsxs)("div",{children:["Owner: ",r]}),(0,a.jsxs)("div",{children:["Tester Count: ",o.toString()]}),(0,a.jsx)("div",{children:"Testers"}),c.map(e=>(0,a.jsx)("div",{children:e},e)),(0,a.jsx)("input",{type:"text",placeholder:"recipient",value:d,onChange:e=>p({address:e.target.value}),className:(0,v.cn)(u.pk)}),(0,a.jsx)(s.v,{tx:"Write",disabled:!d,config:{abi:i.Og,address:t.assetTokenFeed,functionName:"setTester",args:[d,!0]},className:"!mt-0  max-w-[100px] flex items-center justify-center gap-4"})]})}function Erc20Approve(){let[e,t]=(0,g.Z)({token:"",spender:"",amount:0n});return(0,a.jsxs)(u.Ak,{tit:"Erc20Approve",children:[(0,a.jsx)("input",{type:"text",placeholder:"token",value:e.token,onChange:e=>t({token:e.target.value}),className:(0,v.cn)(u.pk)}),(0,a.jsx)("input",{type:"text",placeholder:"spender",value:e.spender,onChange:e=>t({spender:e.target.value}),className:(0,v.cn)(u.pk)}),(0,a.jsx)("input",{type:"text",placeholder:"amount",value:e.amount.toString(),onChange:e=>{try{t({amount:(0,v.su)(e.target.value,0)})}catch(e){}},className:(0,v.cn)(u.pk)}),(0,a.jsx)(s.v,{tx:"Write",disabled:!(0,w.U)(e.token)||!(0,w.U)(e.spender)||e.amount<=0n,config:{abi:y.Wo,address:e.token,functionName:"approve",args:[e.spender,e.amount]},className:"!mt-0 w-full flex items-center justify-center gap-4"})]})}let N=[{label:"赎回手续费",value:"C"}];function InitReinit(e){let{vault:t}=e,{data:n}=(0,f.uX)({contracts:[{abi:i.qU,address:t,functionName:"paramValue",args:[(0,h.$G)("D",{size:32})]},{abi:i.qU,address:t,functionName:"nftVtAmount"},{abi:i.qU,address:t,functionName:"nftVestingEndTime"},{abi:i.qU,address:t,functionName:"nftVestingDuration"},{abi:i.qU,address:t,functionName:"ytSwapPaymentToken"},{abi:i.qU,address:t,functionName:"ytSwapPrice"}]}),{data:s}=(0,f.D2)({abi:i.qU,address:t,functionName:"initialized"}),r=null==n?void 0:n.map(e=>{var t;return(null===(t=e.result)||void 0===t?void 0:t.toString())||""});return(0,a.jsx)(u.UT,{abi:i.qU,tit:"InitOrReinit",txProps:{disabled:"boolean"!=typeof s},functionName:s?"reInitialize":"initialize",address:t,argsDef:r},"lnt-vault-init")}function DeleteIpAssets(e){let{data:t}=(0,f.D2)({abi:i.j5,address:e.vault,functionName:"ipAssets"}),n={};return null==t||t.forEach(e=>{n[e]=d.LF[e]}),(0,a.jsx)(u.UT,{abi:i.j5,functionName:"removeIpAsset",address:e.vault,infos:JSON.stringify(n,void 0,2)},"b-vault-removeIpAsset")}function AdminPage(){let e=(0,p.p)(),{current:t,setState:n,options:s}=(0,m.G)(),d=(0,l.I$)();return(0,a.jsx)(r.E,{children:(0,a.jsx)("div",{className:"w-full flex",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 w-full max-w-[840px] mx-auto px-5",children:[(0,a.jsx)("div",{className:"text-lg whitespace-pre-wrap p-2 bg-primary/20 rounded-xl",children:JSON.stringify({Decimal18:"000000000000000000"},void 0,2)}),(0,a.jsx)(b.ZP,{classNames:u.At,defaultValue:s[0],options:s,onChange:e=>e&&n({current:e})}),(null==t?void 0:t.type)=="L-Vault"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(UpdateVaultParams,{vault:t.data.vault,paramList:k,protocoSettingAddress:c.e_[e]}),(0,a.jsx)(UpdateVaultPrice,{vc:t.data}),["pauseMint","unpauseMint","pauseRedeem","unpauseRedeem","pauseUsbToMarginTokens","unpauseUsbToMarginTokens"].map(e=>(0,a.jsx)(u.UT,{functionName:e,abi:i.WW,address:t.data.vault},"l-vault-".concat(e))),(0,a.jsx)(u.UT,{abi:i.EF,functionName:"transferOwnership",address:c.Vq[e]}),(0,a.jsx)(ClaimYieldsForBuyPool,{vc:t.data}),(null==d?void 0:d.testnet)&&(0,a.jsx)(SetTester,{vc:t.data})]}),(null==t?void 0:t.type)=="P-Vault"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(UpdateVaultParams,{vault:t.data.vault,paramList:N,protocoSettingAddress:c.e_[e]}),["configureBlastYieldsAndGas","configureBlastPoints"].map(e=>(0,a.jsx)(u.UT,{abi:i.a4,functionName:e,address:t.data.vault},"p-vault-".concat(e)))]}),(null==t?void 0:t.type)=="B-Vault"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(UpdateVaultParams,{vault:t.data.vault,paramList:S,protocoSettingAddress:t.data.protocolSettingsAddress}),(0,a.jsx)(DeleteIpAssets,{vault:t.data.vault}),["addIpAsset","updateMaxIpAssets","updateC","close","pause","unpause","pauseRedeemPool","unpauseRedeemPool","addBribeToken","addBribes","setBriber"].map(e=>(0,a.jsx)(u.UT,{abi:i.j5,functionName:e,address:t.data.vault},"b-vault-".concat(e))),(0,a.jsx)(u.UT,{tit:"transferOwnership",abi:i.RR,functionName:"transferOwnership",address:t.data.protocolAddress}),(0,a.jsx)(u.UT,{tit:"upsertParamConfig",abi:i.$4,functionName:"upsertParamConfig",address:t.data.protocolSettingsAddress})]}),(null==t?void 0:t.type)=="Lnt-Vault"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(UpdateVaultParams,{vault:t.data.vault,paramList:V,protocoSettingAddress:t.data.protocolSettingsAddress}),(0,a.jsx)(InitReinit,{vault:t.data.vault}),["startEpoch1","updateNftDepositClaimableTime","depositNftVestingToken","withdrawNftVestingToken","addYtRewards"].map(e=>(0,a.jsx)(u.UT,{abi:i.qU,functionName:e,address:t.data.vault},"lnt-vault-".concat(e))),(0,a.jsx)(u.UT,{tit:"transferOwnership",abi:i.RR,functionName:"transferOwnership",address:t.data.protocolAddress}),(0,a.jsx)(u.UT,{tit:"upsertParamConfig",abi:i.$4,functionName:"upsertParamConfig",address:t.data.protocolSettingsAddress}),(null==d?void 0:d.testnet)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.UT,{tit:"mintMockNFT",abi:i.Oq,functionName:"safeMint",address:t.data.asset}),(0,a.jsx)(u.UT,{tit:"mintMockERC20",abi:i.vJ,functionName:"mint",address:t.data.vestingToken})]})]}),(null==t?void 0:t.type)=="B-Vault2"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(UpdateVaultParams,{vault:t.data.vault,paramList:j,protocoSettingAddress:t.data.protocalSettings}),["initialize","updateThreshold","pause","unpause"].map(e=>(0,a.jsx)(u.UT,{abi:o.t9,functionName:e,address:t.data.vault},"b-vault2-".concat(e))),(0,a.jsx)(u.UT,{tit:"transferOwnership",abi:i.RR,functionName:"transferOwnership",address:t.data.protocal}),(0,a.jsx)(u.UT,{tit:"upsertParamConfig",abi:i.$4,functionName:"upsertParamConfig",address:t.data.protocalSettings}),(null==d?void 0:d.testnet)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.UT,{tit:"mint (".concat((0,v.kb)(t.data.asset).symbol,")"),abi:i.vJ,functionName:"mint",address:t.data.asset}),(0,a.jsx)(u.UT,{tit:"setTester (".concat((0,v.kb)(t.data.asset).symbol,")"),abi:i.vJ,functionName:"setTester",address:t.data.asset})]})]}),(0,a.jsx)(Erc20Approve,{})]})})})}},81943:function(e,t,n){"use strict";n.d(t,{HP:function(){return d},Pq:function(){return u},T_:function(){return c},aA:function(){return i},c1:function(){return l},oW:function(){return o},t9:function(){return s},xd:function(){return r}});var a=n(95891);let s=(0,a.V)(["function initialized() view returns (bool)","function BT() external view returns (address)","function Points() external view returns (address)","function bootstrapStartTime() external view returns (uint256)","function bootstrapDuration() external view returns (uint256)","function bootstrapThreshold() external view returns (uint256)","function totalDeposits() external view returns (uint256)","function bootstrapSucceeded() public view returns (bool)","function bootstrapStarted() public view returns (bool)","function bootstrapEnded() public view returns (bool)","function bootstrapFailed() public view returns (bool)","function bootstrapping() public view returns (bool)","function currentEpochId() public view returns (uint256)","function epochIdCount() public view returns (uint256)","function epochIdAt(uint256 index) public view returns (uint256)","function epochInfoById(uint256 epochId) public view returns (Epoch memory)","struct Epoch {uint256 epochId;uint256 startTime;uint256 duration;address PT;address YT;}","function addLiquidity(uint256 amountBT, uint256 minAmountBT, uint256 deadline) external returns (uint256 amountShares, uint256 amountPT, uint256 amountYT)","function removeLiquidity(uint256 shares, uint256 minAmountBT, uint256 deadline) external returns (uint256 amountBT, uint256 amountPT, uint256 amountYT)","function swapExactBTForPT(uint256 amountBT, uint256 minAmountPT, uint256 deadline) external returns (uint256 amountPT)","function swapExactPTForBT(uint256 amountPT, uint256 minAmountBT, uint256 deadline) external returns (uint256 amountBT)","function swapExactBTForYT(uint256 amountBT, uint256 amountBT1, uint256 minRefundBT, uint256 deadline) external returns (uint256 amountYT, uint256 refundBT)","function swapExactYTForBT(uint256 amountYT, uint256 minAmountBT, uint256 deadline) external returns (uint256 amountBT)","function initialize(uint256 _bootstrapStartTime, uint256 _bootstrapDuration, uint256 _bootstrapThreshold) external","function updateThreshold(uint256 _threshold) external","function pause() external","function unpause() external"]),u=(0,a.V)(["function deposit(address receiver,address tokenIn,uint256 amountTokenToDeposit,uint256 minSharesOut) external payable returns (uint256 amountSharesOut)","function redeem(address receiver,uint256 amountSharesToRedeem,address tokenOut,uint256 minTokenOut) external payable returns (uint256 amountTokenOut)","function previewDeposit(address tokenIn,uint256 amountTokenToDeposit) external view returns (uint256 amountSharesOut)","function previewRedeem(address tokenOut,uint256 amountSharesToRedeem) external view returns (uint256 amountTokenOut)","function getTokensIn() public view returns (address[] memory res)","function getTokensOut() public view returns (address[] memory res)","function exchangeRate() public view returns (uint256 res)"]),r=(0,a.V)(["function getYieldSwapHook(address bt) public view returns (address)"]),i=(0,a.V)(["function mint(address BT, uint256 amount) external","function redeem(address BT, uint256 amount) external"]),o=(0,a.V)(["function redeem(address PT, uint256 amount) external"]),l=(0,a.V)(["function getAmountOutBTToVPT(uint256 amountBT) external view returns (uint256 amountVPT)","function getAmountOutVPTToBT(uint256 amountVPT) external view returns (uint256 amountBT)"]),c=(0,a.V)(["function quoteExactBTforYT(address hook,uint256 amountBT,uint256 amountBT1) external view returns (uint256 amountYT, uint256 expectedRefundBT)","function quoteExactYTforBT(address hook,uint256 amountYT) external view returns (uint256 amountBT)","function calcBT1ForSwapBTForYT(address hook,uint256 amountBT) external view returns (uint256 bestAmountBT1)","struct LogData { uint256 BTtp;uint256 BTnet;uint256 Anet;uint256 PTc;uint256 YTc;uint256 vPT;uint256 pt;uint256 Feerate;uint256 ShareTotal;}","function getLog(address protocol, address BT) external view returns(LogData memory log)","function calcRemoveLP(address protocol,address hook,address BT,uint256 shares) external view returns(uint256 amountBT, uint256 amountPT, uint256 amountYT)","function calcAddLP(address protocol,address hook,address BT,uint256 amountBT) external view returns(uint256 amountPT, uint256 amountYT, uint256 amountShares)"]),d=(0,a.V)(["function getUserRewards(address user) external view returns (uint256[] memory rewardAmounts)","function getRewardTokens() public view returns (address[] memory rewardTokens)","function claimRewards(address user) external"])},42929:function(e,t,n){"use strict";n.d(t,{LF:function(){return T},Zi:function(){return useBVaultUnderlyingAPY},tY:function(){return useBvaultROI}});var a=n(51767),s=n(6062),u=n(4605),r=n(66986),i=n(181),o=n(64370),l=n(83978),c=n.n(l),d=n(95891),p=n(35004),m=n(11292),f=n(67541);let v=(0,d.V)(["struct UserStakeAmountDetail { address stakeTokenAddress; uint256 amount; uint8 lockup; uint256 lastStakeTimestamp;}","function getUserStakeAmountForIP(address _ipAsset, address _user) external view returns (UserStakeAmountDetail[][] memory)","function getTotalStakeWeightedInIPForIP(address _ipAsset) external view returns (uint256)","function getTotalStakeAmountForIP(address _ipAsset, address[] calldata _stakeTokens) external view returns (uint256[] memory)","struct RewardPoolState {address rewardToken;uint8 rewardTokenType;uint8 distributionType;uint256 rewardsPerEpoch;uint256 rewardPerToken;uint256 totalRewards;uint256 totalDistributedRewards;uint256 lastEpochBlock;}","function getRewardPools(address _ipAsset) external view returns (RewardPoolState[][] memory)","function calculateIPWithdrawal(uint256 _vIPToBurn) external view returns (uint256)"]),T={"0xB1D831271A68Db5c18c8F0B69327446f7C8D0A42":"IPPY","0x0a0466c312687027E2BEa065d4Cca0DCEC19bb2C":"Globkins","0xCdF104e4F24d593E16B9F6c382cEB1FB5573EEDd":"Mimboku","0x8c40Ef7408D6036Dca0b69E67D960dd48014cB16":"Sofamon","0x00e23f81e489E43484B0B8Bc109faD6C1F4c28E7":"Benjamin","0x42A351E005De1330DeDe69Ca4Ae1B06715a2f4fA":"WTF"};function useBVaultUnderlyingAPY(e){let t=e.vault,{data:n}=(0,o.a)({initialData:[],queryKey:["bvualtipassets",t],enabled:!!t,queryFn:async()=>{let e=await (0,r.B)().readContract({abi:a.j5,address:t,functionName:"ipAssets"});return console.info("ipAssets:",e),e}});return(0,o.a)({initialData:{avrageApy:0n,items:[]},queryKey:["bvualtunderlyingapy",t,n],enabled:!!t&&n.length>0,gcTime:36e5,queryFn:async()=>{let a=(0,r.B)((0,s.BV)(),1),i=await a.readContract({abi:v,address:"0xf6701A6A20639f0E765bA7FF66FD4f49815F1a27",functionName:"calculateIPWithdrawal",args:[(0,p.f)("1")]}),o=(0,p.f)("2.367"),apyByIpAsset=async n=>{let[[s],r]=await Promise.all([a.readContract({abi:v,functionName:"getTotalStakeAmountForIP",address:e.ipAssetStaking,args:[n,[e.asset]]}),a.readContract({abi:v,functionName:"getTotalStakeWeightedInIPForIP",address:e.ipAssetStaking,args:[n]})]),l=(0,p.f)("0.00009"),c=r>0n?l*u.SH*u.Pq/o*u.Pq/r:0n;s>=(0,p.f)("100")&&i>0n&&r>0n&&(c+=(0,p.f)("7.5")*u.Pq/i*(s*u.Pq/r)/u.Pq/100n);let d=4n*c;return console.info("underlyingApy:",t,n,(0,m.d)(d)),d},l=await Promise.all(n.map(apyByIpAsset)),c=await Promise.all(n.map(n=>a.readContract({abi:v,functionName:"getUserStakeAmountForIP",address:e.ipAssetStaking,args:[n,t]}))),d=c.map(e=>{var t;return null===(t=e.find(e=>e.length))||void 0===t?void 0:t.find(e=>!!e)}),f=d.reduce((e,t)=>e+((null==t?void 0:t.amount)||0n),0n),b=f>0n?l.map((e,t)=>{var n;return e*((null==d?void 0:null===(n=d[t])||void 0===n?void 0:n.amount)||0n)}).reduce((e,t)=>e+t,0n)/f:0n,g=l.map((e,t)=>{var a;return{apy:e,staked:(null==d?void 0:null===(a=d[t])||void 0===a?void 0:a.amount)||0n,ipID:n[t],tit:T[n[t]]}}).sort((e,t)=>{let n=t.apy-e.apy;return n>0n?1:n<0n?-1:0});return console.info("staked:",t,d,b),{avrageApy:b,items:g}}})}function calcRestakingApy(e,t,n,a,s){let r=t*e*n/u.Pq/u.SH,i=a>0n?r*u.Pq/a:0n,o=s>0n?i*u.Pq/s:0n;return o}function calcAdditionalApy(e,t,n,a){let s=e+t*n,r=0n*u.Pq,i=s>0n?r*u.Pq/s:0n,o=u.Pq*n,l=i*o/u.Pq,c=a>0n?l*u.Pq/a:0n;return c}function calcAdditionalApy2(e,t,n){let a=0n*u.Pq,s=e>0n?a*u.Pq/e:0n,r=u.Pq*t,i=s*r/u.Pq,o=n>0n?i*u.Pq/n:0n;return o}function useBvaultROI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0n,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n,s=e.vault,l=(0,i.nr)(s),{data:{avrageApy:d}}=useBVaultUnderlyingAPY(e),p=l.current.yTokenAmountForSwapYT,m=l.current.vaultYTokenBalance,v=l.current.duration+l.current.startTime-BigInt(c().round(c().now()/1e3)),T=l.pTokenTotal,b=m>0n?l.Y*u.Pq/m:0n,g=calcRestakingApy(d,T,v,p,b),x=t>0n?calcRestakingApy(d,T,v,p+t,n):0n,{data:h}=function(e){let t=(0,i.nr)(e);return(0,o.a)({initialData:0n,gcTime:36e5,queryKey:["ytPoints",e,t.current.adhocBribesPool],enabled:!!e&&!!t.current.adhocBribesPool,queryFn:async()=>{let e=(0,r.B)();return t.current.adhocBribesPool===f.DR?0n:e.readContract({abi:a.q3,address:t.current.adhocBribesPool,functionName:"totalSupply"})}})}(s),B=e.pTokenV2?calcAdditionalApy2(l.ytPointsMaxTotalSupply,v,b):calcAdditionalApy(h,p,v,b),A=t>0n?e.pTokenV2?calcAdditionalApy2(l.ytPointsMaxTotalSupply+t*v,v,n):calcAdditionalApy(h,p+t,v,n):0n;return{roi:g>0n?g+B-u.Pq:0n,roiChange:x>0n?x+A-u.Pq:0n,restakingIncomesApy:g,additionalRoi:B}}},181:function(e,t,n){"use strict";n.d(t,{R3:function(){return useUpBVaultForUserAction},Vw:function(){return useEpochesData},Zd:function(){return useBVaultEpoches},d6:function(){return useResetBVaultsData},gz:function(){return useCalcClaimable},lL:function(){return calcBVaultPTApy},nr:function(){return useBVault},oU:function(){return useBVaultApy},v7:function(){return useBVaultBoost}});var a=n(4605),s=n(90947),u=n(15493),r=n(2360),i=n(83978),o=n.n(i),l=n(83508),c=n(6951),d=n(86026);function useResetBVaultsData(){let e=(0,s.p)(),{address:t}=(0,c.m)();(0,l.useEffect)(()=>{},[e]),(0,l.useEffect)(()=>{d.w.getState().sliceUserBVaults.reset()},[t])}function useBVault(e){return(0,d.o)(t=>t.sliceBVaultsStore.bvaults[e]||(0,u.Yb)({current:(0,u.Yb)({},0n)},0n),["sliceBVaultsStore.bvaults.".concat(e)])}function useBVaultEpoches(e){return(0,d.o)(t=>{let n=t.sliceBVaultsStore.bvaults[e];if(!n||n.epochCount<=0n)return[];let a=o().range(1,parseInt((n.epochCount+1n).toString())).reverse(),s=t.sliceBVaultsStore.epoches;return a.map(t=>s["".concat(e,"_").concat(t)]).filter(e=>null!=e)},["sliceBVaultsStore.bvaults.".concat(e),"sliceBVaultsStore.epoches"])}function useEpochesData(e){let t=useBVaultEpoches(e),n=(0,d.o)(t=>t.sliceUserBVaults.epoches[e]||[],["sliceUserBVaults.epoches.".concat(e)]);return(0,l.useMemo)(()=>{let e=n.reduce((e,t)=>({...e,[t.epochId.toString()]:t}),{});return t.map(t=>(0,u.Yb)({...t,...e[t.epochId.toString()]||{bribes:[],sBribes:[],aBribes:[]}},0n))},[t,n])}function useCalcClaimable(e){let t=useEpochesData(e);return(0,l.useMemo)(()=>{let e=t.filter(e=>e.claimableAssetBalance&&e.settled);return{ids:e.map(e=>e.epochId),claimable:e.reduce((e,t)=>e+t.claimableAssetBalance,0n)}},[t])}function useBVaultBoost(e){let t=(0,d.o)(()=>(function(e){let t=d.w.getState(),n=t.sliceBVaultsStore.bvaults[e],s=(null==n?void 0:n.current.vaultYTokenBalance)||0n,u=(null==n?void 0:n.Y)||0n,i=u>0n?s*a.Pq/u:0n,o=(null==n?void 0:n.current.yTokenAmountForSwapYT)||0n,l=(null==n?void 0:n.lockedAssetTotal)||0n,c=o>0n?l*a.Pq/o:0n;return console.info("calcBootst:",(0,r.d)(i),(0,r.d)(c)),a.Pq,i})(e),["sliceBVaultsStore.bvaults.".concat(e)]);return[(0,r.d)(t,0),t]}function calcBVaultPTApy(e){let t=d.w.getState(),n=t.sliceBVaultsStore.bvaults[e.vault],s=(0,u.ok)(t.sliceBVaultsStore.yTokenSythetic,[e.vault]),r=0n;return r=e.pTokenV2?n&&n.ptRebaseRate&&n.pTokenTotal?n.ptRebaseRate/a.Pq*a.SH*BigInt(1e10)/n.pTokenTotal/a.Pq:0n:n&&n.current.assetTotalSwapAmount&&s?n.current.assetTotalSwapAmount*a.SH*BigInt(1e10)/s:0n,console.info("apy:",e.vault,r,e.pTokenV2,null==n?void 0:n.ptRebaseRate,null==n?void 0:n.pTokenTotal),r}function useBVaultApy(e){let t=(0,d.o)(()=>calcBVaultPTApy(e),["sliceBVaultsStore.bvaults.".concat(e.vault),"sliceBVaultsStore.yTokenSythetic.".concat(e.vault)]);return[(0,u.Jh)(t,10),t]}function useUpBVaultForUserAction(e,t){let{address:n}=(0,c.m)();return()=>{(0,u.XD)(async()=>{if(null==t||t(),!n)return;await Promise.all([d.w.getState().sliceTokenStore.updateTokensBalance([e.asset,e.pToken],n),d.w.getState().sliceTokenStore.updateTokenTotalSupply([e.asset,e.pToken]),d.w.getState().sliceBVaultsStore.updateBvaults([e]),d.w.getState().sliceBVaultsStore.updateYTokenSythetic([e])]);let a=d.w.getState().sliceBVaultsStore.bvaults[e.vault];await d.w.getState().sliceBVaultsStore.updateEpoches(e,a.epochCount>1n?[a.epochCount,a.epochCount-1n]:[a.epochCount]);let s=[];for(let t=parseInt(a.epochCount.toString());t>0;t--){let n=d.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(t)];s.push(n)}console.info("onUserAction:epoches",s),await d.w.getState().sliceUserBVaults.updateEpoches(e,n,s)},3,1e3)}}},85665:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var a=n(83508),s=n(17695),u=s.jU?a.useLayoutEffect:a.useEffect,r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0},i=s.jU&&void 0!==window.ResizeObserver?function(){var e=(0,a.useState)(null),t=e[0],n=e[1],s=(0,a.useState)(r),i=s[0],o=s[1],l=(0,a.useMemo)(function(){return new window.ResizeObserver(function(e){if(e[0]){var t=e[0].contentRect;o({x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,left:t.left,bottom:t.bottom,right:t.right})}})},[]);return u(function(){if(t)return l.observe(t),function(){l.disconnect()}},[t]),[n,i]}:function(){return[s.ZT,r]}}},function(e){e.O(0,[7495,4881,5294,7622,4598,9357,8702,8178,4655,3960,5907,4920,170,6026,9205,4225,8179,1744],function(){return e(e.s=83970)}),_N_E=e.O()}]);