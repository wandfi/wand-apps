"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1668],{62653:function(t,e,s){s.d(e,{Z:function(){return m}});var a=s(55731),i=s(83508),r=s(13012),n=s(40460);let o={0:"grid-cols-none",1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10",11:"grid-cols-11",12:"grid-cols-12"},l={0:"sm:grid-cols-none",1:"sm:grid-cols-1",2:"sm:grid-cols-2",3:"sm:grid-cols-3",4:"sm:grid-cols-4",5:"sm:grid-cols-5",6:"sm:grid-cols-6",7:"sm:grid-cols-7",8:"sm:grid-cols-8",9:"sm:grid-cols-9",10:"sm:grid-cols-10",11:"sm:grid-cols-11",12:"sm:grid-cols-12"},c={0:"md:grid-cols-none",1:"md:grid-cols-1",2:"md:grid-cols-2",3:"md:grid-cols-3",4:"md:grid-cols-4",5:"md:grid-cols-5",6:"md:grid-cols-6",7:"md:grid-cols-7",8:"md:grid-cols-8",9:"md:grid-cols-9",10:"md:grid-cols-10",11:"md:grid-cols-11",12:"md:grid-cols-12"},d={0:"lg:grid-cols-none",1:"lg:grid-cols-1",2:"lg:grid-cols-2",3:"lg:grid-cols-3",4:"lg:grid-cols-4",5:"lg:grid-cols-5",6:"lg:grid-cols-6",7:"lg:grid-cols-7",8:"lg:grid-cols-8",9:"lg:grid-cols-9",10:"lg:grid-cols-10",11:"lg:grid-cols-11",12:"lg:grid-cols-12"},u=(0,r.fn)("Grid"),Grid_c=(t,e)=>t&&Object.keys(e).includes(String(t))?e[t]:"",m=i.forwardRef((t,e)=>{let{numItems:s=1,numItemsSm:r,numItemsMd:m,numItemsLg:h,children:p,className:g}=t,f=(0,a._T)(t,["numItems","numItemsSm","numItemsMd","numItemsLg","children","className"]),b=(0,i.useMemo)(()=>{let t=Grid_c(s,o),e=Grid_c(r,l),a=Grid_c(m,c),i=Grid_c(h,d);return(0,n.q)(t,e,a,i)},[s,r,m,h]);return i.createElement("div",Object.assign({ref:e,className:(0,n.q)(u("root"),"grid",b,g)},f),p)});m.displayName="Grid"},97049:function(t,e,s){s.d(e,{r:function(){return a.Z}});var a=s(62653)},81668:function(t,e,s){s.r(e),s.d(e,{default:function(){return Vaults}});var a=s(52628),i=s(90343),r=s(51767),n=s(6194),o=s(15493),l=s(66986),c=s(86026),d=s(181),u=s(36437),m=s(2360),h=s(64370),p=s(95499),g=s(83978),f=s.n(g),b=s(83508),x=s(83960),v=s(93650),y=s(47259),w=s(67541),j=s(61766),C=s(58714),k=s(6951),N=s(36602),S=s(98589),T=s(19671);function PulseTokenItem(){return(0,a.jsxs)("div",{className:"animate-pulse flex px-4 py-2 items-center gap-4 rounded-lg",children:[(0,a.jsx)("div",{className:"rounded-full w-10 h-10 bg-slate-400"}),(0,a.jsx)("div",{className:"w-28 h-5 rounded-lg bg-slate-400"}),(0,a.jsx)("div",{className:"ml-auto w-12 h-5 rounded-lg bg-slate-400"})]})}var R=s(82053),M=s(70475);let O=[{symbol:"vIP",name:"Verio IP",address:"0x5267F7eE069CEB3D8F1c760c215569b79d0685aD",decimals:18},{symbol:"WIP",name:"Wrapped IP",address:"0x1514000000000000000000000000000000000000",decimals:18}];function TokenSelect(t){let{tokens:e,onSelect:s,hiddenNative:i}=t,r=(0,c.o)(t=>t.sliceTokenStore.defTokenList),d=(0,b.useMemo)(()=>{let t=f().isEmpty(e)?f().isEmpty(r)?O:r:e;return i?t.filter(t=>t.address!==w.DR&&t.address!==n.K8):t},[e,r,i]),[p,g]=(0,b.useState)(""),x=(0,u.ln)(),{address:y}=(0,k.m)(),[N,S]=(0,b.useState)(["searchTokens",p,d]);(0,v.Z)(()=>S(["searchTokens",p,d]),300,[p,d]);let{data:R,isFetching:M}=(0,h.a)({initialData:d,queryFn:async()=>{if((0,j.U)(p)){let t=d.find(t=>t.address==p);if(t)return[t];let e=(0,l.B)(),[s,a]=await Promise.all([e.readContract({abi:C.Wo,address:p,functionName:"symbol"}),e.readContract({abi:C.Wo,address:p,functionName:"decimals"})]);return y&&c.w.getState().sliceTokenStore.updateTokensBalance([p],y),[{symbol:s,address:p,decimals:a}]}return p?d.filter(t=>{let e=p.toLowerCase(),s=!!t.symbol.toLowerCase().match(e),a=!!t.name&&!!t.name.toLowerCase().match(e);return s||a}):d},queryKey:N}),F=R||d;return(0,h.a)({queryKey:["updateBalancesForUnknowToken",d],enabled:!!y,queryFn:()=>c.w.getState().sliceTokenStore.updateTokensBalance(d.map(t=>t.address),y)}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-5",children:[(0,a.jsx)("div",{className:"page-sub text-center",children:"Select a token"}),(0,a.jsx)("input",{className:(0,o.cn)("bg-white dark:bg-transparent","border-slate-400  focus:border-primary","w-full h-14 text-right px-4 font-bold text-base border-[#4A5546] border focus:border-2 text-slate-700 rounded-lg outline-none dark:text-slate-50"),placeholder:"Search by name, symbol or address",value:p,onChange:t=>g(t.target.value)}),(0,a.jsx)("div",{className:"flex flex-col overflow-y-auto h-[18.75rem]",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(PulseTokenItem,{}),(0,a.jsx)(PulseTokenItem,{}),(0,a.jsx)(PulseTokenItem,{})]}):(0,a.jsx)(a.Fragment,{children:F.map(t=>(0,a.jsxs)("div",{className:"flex px-4 py-2 items-center gap-4 rounded-lg cursor-pointer hover:bg-primary/20",onClick:()=>{null==s||s(t)},children:[(0,a.jsx)(T.c,{className:"rounded-full",size:40,symbol:t.symbol,url:t.url}),(0,a.jsx)("span",{children:t.symbol}),(0,a.jsx)("span",{className:"ml-auto",children:(0,m.d)(x[t.address],3,t.decimals)})]},t.address))})})]})}function BVaultAddReward(t){let{bvc:e}=t,s=(0,u.ln)(),i=(0,d.nr)(e.vault),n=(0,c.o)(t=>t.sliceTokenStore.defTokenList),m=f().isEmpty(n)?O[0]:n[0],[h,g]=(0,b.useState)(m),[v,w]=(0,b.useState)(""),j=s[h.address],T=(0,o.su)(v,h.decimals),F=(0,b.useRef)(null),B=(0,N.p)(),{address:E}=(0,k.m)(),{mutate:P,isPending:I}=(0,p.D)({mutationFn:async()=>{if(A)return;let t=(0,l.B)();if(e.isOld){let s=await t.readContract({abi:r.j5,address:e.vault,functionName:"bribeTokens",args:[i.epochCount]});if(console.info("tokens:",s,h.address),!s.find(t=>t.toLowerCase()==h.address.toLowerCase())){let s=await B.data.writeContract({abi:r.j5,address:e.vault,functionName:"addBribeToken",args:[h.address]});await t.waitForTransactionReceipt({hash:s,confirmations:3})}let a=await t.readContract({abi:C.Wo,address:h.address,functionName:"allowance",args:[E,e.vault]});if(a<T){let s=await B.data.writeContract({abi:C.Wo,address:h.address,functionName:"approve",args:[e.vault,T-a]});await t.waitForTransactionReceipt({hash:s,confirmations:3})}let n=await B.data.writeContract({abi:r.j5,address:e.vault,functionName:"addBribes",args:[h.address,T]});await t.waitForTransactionReceipt({hash:n,confirmations:3})}else{let s=await t.readContract({abi:C.Wo,address:h.address,functionName:"allowance",args:[E,e.vault]});if(s<T){let a=await B.data.writeContract({abi:C.Wo,address:h.address,functionName:"approve",args:[e.vault,T-s]});await t.waitForTransactionReceipt({hash:a,confirmations:3})}let a=await B.data.writeContract({abi:r.j5,address:e.vault,functionName:"addAdhocBribes",args:[h.address,T]});await t.waitForTransactionReceipt({hash:a,confirmations:3})}c.w.getState().sliceTokenStore.updateTokensBalance([h.address],E),w(""),y.A.success("Transaction success")},mutationKey:["addReward"],onError:o.S3}),A=!B.data||!E||0n==T||T>j||I||0n==i.epochCount;return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto mt-8 card",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(S.W,{decimals:h.decimals,asset:h.symbol,assetURL:h.url,balance:s[h.address],amount:v,setAmount:w}),(0,a.jsx)(R.o,{trigger:(0,a.jsxs)("div",{ref:F,className:"absolute left-0 top-0 flex cursor-pointer justify-end items-center py-4",children:[(0,a.jsx)("span",{className:"invisible pl-12",children:h.symbol}),(0,a.jsx)(x.tv1,{className:"ml-2"})]}),children:(0,a.jsx)(TokenSelect,{hiddenNative:!0,onSelect:t=>{var e;g(t),null===(e=F.current)||void 0===e||e.click()}})})]}),(0,a.jsx)(M.k6,{busy:I,className:"w-full flex justify-center items-center gap-2",disabled:A,onClick:()=>P(),children:"Add"})]})}var F=s(67039),B=s(3107),E=s(84633),P=s(31480),I=s(4605),A=s(90947),V=s(766),_=s(97049),D=s(38762),L=s(35496),K=s(75847);let q=["redeem","principal_panda","yield_token","add_reward"];function BVaultPage(t){var e;let{bvc:s,currentTab:n}=t,{address:u}=(0,k.m)(),m=(0,d.nr)(s.vault);(0,h.a)({queryKey:["UpdateVaultDetails",s,m],queryFn:async()=>0n!=m.epochCount&&(await c.w.getState().sliceBVaultsStore.updateEpoches(s),!0)});let p=(0,d.Zd)(s.vault);(0,h.a)({queryKey:["UpdateUserData",s,p,u],queryFn:async()=>0!=p.length&&!!u&&(console.info("epochesOld:",p),await c.w.getState().sliceUserBVaults.updateEpoches(s,u,p),!0)});let{data:g}=(0,h.a)({queryKey:["checkIsBriber",u,s],queryFn:async()=>{if(!u)return!1;let t=(0,l.B)(),e=await Promise.all([t.readContract({abi:r.j5,address:s.vault,functionName:"isBriber",args:[u]}),t.readContract({abi:r.j5,address:s.vault,functionName:"owner"}).then(t=>t==u)]);return e.includes(!0)||(0,K.E)(u,"0xFE18Aa1EFa652660F36Ab84F122CD36108f903B6")}}),f=[...m.closed?[{tab:"Redeem",content:(0,a.jsx)("div",{className:"max-w-xl mx-auto pt-8 w-full",children:(0,a.jsx)(i.ge,{bvc:s})})}]:[{tab:"Principal Token",content:(0,a.jsx)(i.aK,{bvc:s})}],{tab:"Yield Token",content:(0,a.jsx)(i.Cw,{bvc:s})}],b=g?[...f,{tab:"Add Reward",content:(0,a.jsx)(BVaultAddReward,{bvc:s})}]:f,x=null===(e=b.find(t=>(0,o.pi)(t.tab)==n))||void 0===e?void 0:e.tab,v=(0,D.useRouter)();return(0,a.jsx)(E.x,{currentTab:x,onTabChange:t=>(0,L.rc)(v,s.vault,t),listClassName:"flex-wrap p-0 mb-5 md:gap-14",triggerClassName:'text-lg sm:text-xl md:text-2xl py-0 data-[state="active"]:border-b border-b-black dark:border-b-white leading-[0.8] rounded-none whitespace-nowrap',contentClassName:"gap-5",data:b})}function Vaults(){let t=(0,A.p)(),e=(0,b.useMemo)(()=>P.Fw[t].filter(t=>t.onEnv&&t.onEnv.includes(I.Vi)),[t,I.Vi]),s=(0,D.useSearchParams)(),r=s.get("vault"),n=s.get("tab"),o=q.includes(n)?n:"",l=e.find(t=>t.vault==r);return(0,V.Ev)(),(0,a.jsx)(B.E,{children:(0,a.jsx)("div",{className:"w-full max-w-[1232px] px-4 mx-auto md:pb-8",children:l?(0,a.jsx)(BVaultPage,{bvc:l,currentTab:o}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"page-title",children:"IP-Vaults"}),(0,a.jsx)(F.K,{data:"A Pendle-like Yield Tokenization Protocol Tailored for IP Assets"}),(0,a.jsxs)(_.r,{numItems:1,numItemsMd:2,numItemsLg:3,className:"gap-5 mt-4",children:[e.map((t,e)=>(0,a.jsx)(i.Bx,{vc:t},"group_vault_item_".concat(e))),0==e.length&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.O4,{}),(0,a.jsx)(i.O4,{}),(0,a.jsx)(i.O4,{})]}),1==e.length&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.O4,{}),(0,a.jsx)(i.O4,{})]}),2==e.length&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(i.O4,{})})]})]})})})}},67039:function(t,e,s){s.d(e,{K:function(){return Noti}});var a=s(52628);s(83508);var i=s(63114);function Noti(t){let{data:e}=t;return(0,a.jsxs)("div",{className:"w-full mt-2 mb-3 md:mt-4 md:mb-6 flex text-[24px] md:text-[14px] text-[#64748B] dark:text-slate-50/60 font-medium leading-[24px] md:leading-[14px]",children:[(0,a.jsx)("div",{className:"",children:(0,a.jsx)(i.pMA,{size:20})}),(0,a.jsx)("div",{className:"text-sm ml-1 ",children:e})]})}},36437:function(t,e,s){s.d(e,{A5:function(){return useTotalSupply},b7:function(){return useNftBalance},ln:function(){return useBalances}});var a=s(15493),i=s(86026);function useBalances(){return(0,i.o)(t=>(0,a.Yb)(t.sliceTokenStore.balances,0n),["sliceTokenStore.balances"])}function useNftBalance(t){return(0,i.o)(e=>e.sliceTokenStore.nftBalance[t]||[],["sliceTokenStore.nftBalance.".concat(t)])}function useTotalSupply(t){return(0,i.o)(e=>{var s;return null!==(s=e.sliceTokenStore.totalSupply[t])&&void 0!==s?s:0n},["sliceTokenStore.totalSupply.".concat(t)])}},83716:function(t,e,s){s.d(e,{R:function(){return getDefaultState},m:function(){return n}});var a=s(64583),i=s(93242),r=s(76937),n=class extends i.F{#t;#e;#s;constructor(t){super(),this.mutationId=t.mutationId,this.#e=t.mutationCache,this.#t=[],this.state=t.state||getDefaultState(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#e.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||("pending"===this.state.status?this.scheduleGc():this.#e.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(t){this.#s=(0,r.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#a({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#e.canRun(this)});let e="pending"===this.state.status,s=!this.#s.canStart();try{if(!e){this.#a({type:"pending",variables:t,isPaused:s}),await this.#e.config.onMutate?.(t,this);let e=await this.options.onMutate?.(t);e!==this.state.context&&this.#a({type:"pending",context:e,variables:t,isPaused:s})}let a=await this.#s.start();return await this.#e.config.onSuccess?.(a,t,this.state.context,this),await this.options.onSuccess?.(a,t,this.state.context),await this.#e.config.onSettled?.(a,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(a,null,t,this.state.context),this.#a({type:"success",data:a}),a}catch(e){try{throw await this.#e.config.onError?.(e,t,this.state.context,this),await this.options.onError?.(e,t,this.state.context),await this.#e.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,e,t,this.state.context),e}finally{this.#a({type:"error",error:e})}}finally{this.#e.runNext(this)}}#a(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),a.V.batch(()=>{this.#t.forEach(e=>{e.onMutationUpdate(t)}),this.#e.notify({mutation:this,type:"updated",action:t})})}};function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},95499:function(t,e,s){s.d(e,{D:function(){return useMutation}});var a=s(83508),i=s(83716),r=s(64583),n=s(7539),o=s(72549),l=class extends n.l{#i;#r=void 0;#n;#o;constructor(t,e){super(),this.#i=t,this.setOptions(e),this.bindMethods(),this.#l()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#i.defaultMutationOptions(t),(0,o.VS)(this.options,e)||this.#i.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(e.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(t){this.#l(),this.#c(t)}getCurrentResult(){return this.#r}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#l(),this.#c()}mutate(t,e){return this.#o=e,this.#n?.removeObserver(this),this.#n=this.#i.getMutationCache().build(this.#i,this.options),this.#n.addObserver(this),this.#n.execute(t)}#l(){let t=this.#n?.state??(0,i.R)();this.#r={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#c(t){r.V.batch(()=>{if(this.#o&&this.hasListeners()){let e=this.#r.variables,s=this.#r.context;t?.type==="success"?(this.#o.onSuccess?.(t.data,e,s),this.#o.onSettled?.(t.data,null,e,s)):t?.type==="error"&&(this.#o.onError?.(t.error,e,s),this.#o.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach(t=>{t(this.#r)})})}},c=s(83037),d=s(17275);function useMutation(t,e){let s=(0,c.NL)(e),[i]=a.useState(()=>new l(s,t));a.useEffect(()=>{i.setOptions(t)},[i,t]);let n=a.useSyncExternalStore(a.useCallback(t=>i.subscribe(r.V.batchCalls(t)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=a.useCallback((t,e)=>{i.mutate(t,e).catch(d.Z)},[i]);if(n.error&&(0,d.L)(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:o,mutateAsync:n.mutate}}}}]);