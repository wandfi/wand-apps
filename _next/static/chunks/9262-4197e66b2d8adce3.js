"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9262],{62653:function(e,a,s){s.d(a,{Z:function(){return m}});var t=s(55731),r=s(64103),n=s(13012),l=s(40460);let d={0:"grid-cols-none",1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10",11:"grid-cols-11",12:"grid-cols-12"},i={0:"sm:grid-cols-none",1:"sm:grid-cols-1",2:"sm:grid-cols-2",3:"sm:grid-cols-3",4:"sm:grid-cols-4",5:"sm:grid-cols-5",6:"sm:grid-cols-6",7:"sm:grid-cols-7",8:"sm:grid-cols-8",9:"sm:grid-cols-9",10:"sm:grid-cols-10",11:"sm:grid-cols-11",12:"sm:grid-cols-12"},o={0:"md:grid-cols-none",1:"md:grid-cols-1",2:"md:grid-cols-2",3:"md:grid-cols-3",4:"md:grid-cols-4",5:"md:grid-cols-5",6:"md:grid-cols-6",7:"md:grid-cols-7",8:"md:grid-cols-8",9:"md:grid-cols-9",10:"md:grid-cols-10",11:"md:grid-cols-11",12:"md:grid-cols-12"},c={0:"lg:grid-cols-none",1:"lg:grid-cols-1",2:"lg:grid-cols-2",3:"lg:grid-cols-3",4:"lg:grid-cols-4",5:"lg:grid-cols-5",6:"lg:grid-cols-6",7:"lg:grid-cols-7",8:"lg:grid-cols-8",9:"lg:grid-cols-9",10:"lg:grid-cols-10",11:"lg:grid-cols-11",12:"lg:grid-cols-12"},u=(0,n.fn)("Grid"),Grid_c=(e,a)=>e&&Object.keys(a).includes(String(e))?a[e]:"",m=r.forwardRef((e,a)=>{let{numItems:s=1,numItemsSm:n,numItemsMd:m,numItemsLg:g,children:x,className:f}=e,p=(0,t.__rest)(e,["numItems","numItemsSm","numItemsMd","numItemsLg","children","className"]),b=(0,r.useMemo)(()=>{let e=Grid_c(s,d),a=Grid_c(n,i),t=Grid_c(m,o),r=Grid_c(g,c);return(0,l.q)(e,a,t,r)},[s,n,m,g]);return r.createElement("div",Object.assign({ref:a,className:(0,l.q)(u("root"),"grid",b,f)},p),x)});m.displayName="Grid"},62600:function(e,a,s){s.d(a,{r:function(){return t.Z}});var t=s(62653)},49262:function(e,a,s){s.r(a),s.d(a,{default:function(){return Vaults}});var t=s(31113),r=s(13137),n=s(38894),l=s(19757),d=s(26361),i=s(78403),o=s(55349),c=s(18358),u=s(36602),m=s(84944),g=s(64370),x=s(95499),f=s(83978),p=s.n(f),b=s(64103),v=s(83960),w=s(93650),h=s(47259),j=s(67541),y=s(61766),k=s(58714),N=s(96670),T=s(4408),S=s(91214),C=s(99971);function PulseTokenItem(){return(0,t.jsxs)("div",{className:"animate-pulse flex px-4 py-2 items-center gap-4 rounded-lg",children:[(0,t.jsx)("div",{className:"rounded-full w-10 h-10 bg-slate-400"}),(0,t.jsx)("div",{className:"w-28 h-5 rounded-lg bg-slate-400"}),(0,t.jsx)("div",{className:"ml-auto w-12 h-5 rounded-lg bg-slate-400"})]})}var B=s(2987),F=s(60689);let I=[{symbol:"vIP",name:"Verio IP",address:"0x5267F7eE069CEB3D8F1c760c215569b79d0685aD",decimals:18},{symbol:"WIP",name:"Wrapped IP",address:"0x1514000000000000000000000000000000000000",decimals:18}];function TokenSelect(e){let{tokens:a,onSelect:s,hiddenNative:r}=e,n=(0,o.o)(e=>e.sliceTokenStore.defTokenList),c=(0,b.useMemo)(()=>{let e=p().isEmpty(a)?p().isEmpty(n)?I:n:a;return r?e.filter(e=>e.address!==j.DR&&e.address!==l.K8):e},[a,n,r]),[x,f]=(0,b.useState)(""),v=(0,u.ln)(),{address:h}=(0,N.m)(),[T,S]=(0,b.useState)(["searchTokens",x,c]);(0,w.Z)(()=>S(["searchTokens",x,c]),300,[x,c]);let{data:B,isFetching:F}=(0,g.a)({initialData:c,queryFn:async()=>{if((0,y.U)(x)){let e=c.find(e=>e.address==x);if(e)return[e];let a=(0,i.B)(),[s,t]=await Promise.all([a.readContract({abi:k.Wo,address:x,functionName:"symbol"}),a.readContract({abi:k.Wo,address:x,functionName:"decimals"})]);return h&&o.w.getState().sliceTokenStore.updateTokensBalance([x],h),[{symbol:s,address:x,decimals:t}]}return x?c.filter(e=>{let a=x.toLowerCase(),s=!!e.symbol.toLowerCase().match(a),t=!!e.name&&!!e.name.toLowerCase().match(a);return s||t}):c},queryKey:T}),E=B||c;return(0,g.a)({queryKey:["updateBalancesForUnknowToken",c],enabled:!!h,queryFn:()=>o.w.getState().sliceTokenStore.updateTokensBalance(c.map(e=>e.address),h)}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-5",children:[(0,t.jsx)("div",{className:"page-sub text-center",children:"Select a token"}),(0,t.jsx)("input",{className:(0,d.cn)("bg-white dark:bg-transparent","border-slate-400  focus:border-primary","w-full h-14 text-right px-4 font-bold text-base border-[#4A5546] border focus:border-2 text-slate-700 rounded-lg outline-none dark:text-slate-50"),placeholder:"Search by name, symbol or address",value:x,onChange:e=>f(e.target.value)}),(0,t.jsx)("div",{className:"flex flex-col overflow-y-auto h-[18.75rem]",children:F?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(PulseTokenItem,{}),(0,t.jsx)(PulseTokenItem,{}),(0,t.jsx)(PulseTokenItem,{})]}):(0,t.jsx)(t.Fragment,{children:E.map(e=>(0,t.jsxs)("div",{className:"flex px-4 py-2 items-center gap-4 rounded-lg cursor-pointer hover:bg-primary/20",onClick:()=>{null==s||s(e)},children:[(0,t.jsx)(C.c,{className:"rounded-full",size:40,symbol:e.symbol,url:e.url}),(0,t.jsx)("span",{children:e.symbol}),(0,t.jsx)("span",{className:"ml-auto",children:(0,m.d)(v[e.address],3,e.decimals)})]},e.address))})})]})}function BVaultAddReward(e){let{bvc:a}=e,s=(0,u.ln)(),r=(0,c.nr)(a.vault),l=(0,o.o)(e=>e.sliceTokenStore.defTokenList),m=p().isEmpty(l)?I[0]:l[0],[g,f]=(0,b.useState)(m),[w,j]=(0,b.useState)(""),y=s[g.address],C=(0,d.su)(w,g.decimals),E=(0,b.useRef)(null),P=(0,T.p)(),{address:_}=(0,N.m)(),{mutate:R,isPending:A}=(0,x.D)({mutationFn:async()=>{if(V)return;let e=(0,i.B)();if(a.isOld){let s=await e.readContract({abi:n.j5,address:a.vault,functionName:"bribeTokens",args:[r.epochCount]});if(console.info("tokens:",s,g.address),!s.find(e=>e.toLowerCase()==g.address.toLowerCase())){let s=await P.data.writeContract({abi:n.j5,address:a.vault,functionName:"addBribeToken",args:[g.address]});await e.waitForTransactionReceipt({hash:s,confirmations:3})}let t=await e.readContract({abi:k.Wo,address:g.address,functionName:"allowance",args:[_,a.vault]});if(t<C){let s=await P.data.writeContract({abi:k.Wo,address:g.address,functionName:"approve",args:[a.vault,C-t]});await e.waitForTransactionReceipt({hash:s,confirmations:3})}let l=await P.data.writeContract({abi:n.j5,address:a.vault,functionName:"addBribes",args:[g.address,C]});await e.waitForTransactionReceipt({hash:l,confirmations:3})}else{let s=await e.readContract({abi:k.Wo,address:g.address,functionName:"allowance",args:[_,a.vault]});if(s<C){let t=await P.data.writeContract({abi:k.Wo,address:g.address,functionName:"approve",args:[a.vault,C-s]});await e.waitForTransactionReceipt({hash:t,confirmations:3})}let t=await P.data.writeContract({abi:n.j5,address:a.vault,functionName:"addAdhocBribes",args:[g.address,C]});await e.waitForTransactionReceipt({hash:t,confirmations:3})}o.w.getState().sliceTokenStore.updateTokensBalance([g.address],_),j(""),h.A.success("Transaction success")},mutationKey:["addReward"],onError:d.S3}),V=!P.data||!_||0n==C||C>y||A||0n==r.epochCount;return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto mt-8 card",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(S.W,{decimals:g.decimals,asset:g.symbol,assetURL:g.url,balance:s[g.address],amount:w,setAmount:j}),(0,t.jsx)(B.o,{trigger:(0,t.jsxs)("div",{ref:E,className:"absolute left-0 top-0 flex cursor-pointer justify-end items-center py-4",children:[(0,t.jsx)("span",{className:"invisible pl-12",children:g.symbol}),(0,t.jsx)(v.tv1,{className:"ml-2"})]}),children:(0,t.jsx)(TokenSelect,{hiddenNative:!0,onSelect:e=>{var a;f(e),null===(a=E.current)||void 0===a||a.click()}})})]}),(0,t.jsx)(F.k,{busy:A,className:"w-full flex justify-center items-center gap-2",disabled:V,onClick:()=>R(),children:"Add"})]})}var E=s(6868),P=s(44939),_=s(16738),R=s(87031),A=s(22139),V=s(59175),q=s(31889),L=s(62600),K=s(69708),O=s(59781),W=s(75847);let D=["redeem","principal_panda","yield_token","add_reward"];function BVaultPage(e){var a;let{bvc:s,currentTab:l}=e,{address:u}=(0,N.m)(),m=(0,c.nr)(s.vault);(0,g.a)({queryKey:["UpdateVaultDetails",s,m],queryFn:async()=>0n!=m.epochCount&&(await o.w.getState().sliceBVaultsStore.updateEpoches(s),!0)});let x=(0,c.Zd)(s.vault);(0,g.a)({queryKey:["UpdateUserData",s,x,u],queryFn:async()=>0!=x.length&&!!u&&(console.info("epochesOld:",x),await o.w.getState().sliceUserBVaults.updateEpoches(s,u,x),!0)});let{data:f}=(0,g.a)({queryKey:["checkIsBriber",u,s],queryFn:async()=>{if(!u)return!1;let e=(0,i.B)(),a=await Promise.all([e.readContract({abi:n.j5,address:s.vault,functionName:"isBriber",args:[u]}),e.readContract({abi:n.j5,address:s.vault,functionName:"owner"}).then(e=>e==u)]);return a.includes(!0)||(0,W.E)(u,"0xFE18Aa1EFa652660F36Ab84F122CD36108f903B6")}}),p=[...m.closed?[{tab:"Redeem",content:(0,t.jsx)("div",{className:"max-w-xl mx-auto pt-8 w-full",children:(0,t.jsx)(r.ge,{bvc:s})})}]:[{tab:"Principal Token",content:(0,t.jsx)(r.aK,{bvc:s})}],{tab:"Yield Token",content:(0,t.jsx)(r.Cw,{bvc:s})}],b=f?[...p,{tab:"Add Reward",content:(0,t.jsx)(BVaultAddReward,{bvc:s})}]:p,v=null===(a=b.find(e=>(0,d.pi)(e.tab)==l))||void 0===a?void 0:a.tab,w=(0,K.useRouter)();return(0,t.jsx)(_.x,{currentTab:v,onTabChange:e=>(0,O.rc)(w,s.vault,e),listClassName:"flex-wrap p-0 mb-5 md:gap-14",triggerClassName:'text-lg sm:text-xl md:text-2xl py-0 data-[state="active"]:border-b border-b-black dark:border-b-white leading-[0.8] rounded-none whitespace-nowrap',contentClassName:"gap-5",data:b})}function Vaults(){let e=(0,V.p)(),a=(0,b.useMemo)(()=>R.Fw[e].filter(e=>e.onEnv&&e.onEnv.includes(A.Vi)),[e,A.Vi]),s=(0,K.useSearchParams)(),n=s.get("vault"),l=s.get("tab"),d=D.includes(l)?l:"",i=a.find(e=>e.vault==n);return(0,q.Ev)(),(0,t.jsx)(P.E,{children:(0,t.jsx)("div",{className:"w-full max-w-[1232px] px-4 mx-auto md:pb-8",children:i?(0,t.jsx)(BVaultPage,{bvc:i,currentTab:d}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"page-title",children:"IP-Vaults"}),(0,t.jsx)(E.K,{data:"A Pendle-like Yield Tokenization Protocol Tailored for IP Assets"}),(0,t.jsxs)(L.r,{numItems:1,numItemsMd:2,numItemsLg:3,className:"gap-5 mt-4",children:[a.map((e,a)=>(0,t.jsx)(r.Bx,{vc:e},"group_vault_item_".concat(a))),0==a.length&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.O4,{}),(0,t.jsx)(r.O4,{}),(0,t.jsx)(r.O4,{})]}),1==a.length&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.O4,{}),(0,t.jsx)(r.O4,{})]}),2==a.length&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(r.O4,{})})]})]})})})}},6868:function(e,a,s){s.d(a,{K:function(){return Noti}});var t=s(31113);s(64103);var r=s(63114);function Noti(e){let{data:a}=e;return(0,t.jsxs)("div",{className:"w-full mt-2 mb-3 md:mt-4 md:mb-6 flex text-[24px] md:text-[14px] text-[#64748B] dark:text-slate-50/60 font-medium leading-[24px] md:leading-[14px]",children:[(0,t.jsx)("div",{className:"",children:(0,t.jsx)(r.pMA,{size:20})}),(0,t.jsx)("div",{className:"text-sm ml-1 ",children:a})]})}},36602:function(e,a,s){s.d(a,{A5:function(){return useTotalSupply},b7:function(){return useNftBalance},ln:function(){return useBalances}});var t=s(26361),r=s(55349);function useBalances(){return(0,r.o)(e=>(0,t.Yb)(e.sliceTokenStore.balances,0n),["sliceTokenStore.balances"])}function useNftBalance(e){return(0,r.o)(a=>a.sliceTokenStore.nftBalance[e]||[],["sliceTokenStore.nftBalance.".concat(e)])}function useTotalSupply(e){return(0,r.o)(a=>{var s;return null!==(s=a.sliceTokenStore.totalSupply[e])&&void 0!==s?s:0n},["sliceTokenStore.totalSupply.".concat(e)])}}}]);