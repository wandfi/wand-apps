"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9109],{7347:function(e,t,a){a.d(t,{kb:function(){return getTokenBy}});var n=a(44964),s=a(92851),o=a(64786),l=a(93305),r=a(53414);let u=[{address:n.DR,symbol:"ETH",decimals:18,chain:[s.R.id,o.F.id],isNative:!0},{address:n.DR,symbol:"IP",decimals:18,chain:[r.yg.id],isNative:!0},{address:"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",symbol:"ETH",decimals:18,chain:[s.R.id,o.F.id],isNative:!0},{address:"0x5267F7eE069CEB3D8F1c760c215569b79d0685aD",symbol:"vIP",decimals:18,chain:[r.yg.id]},{address:"0xADb174564F9065ce497a2Ff8BEC62b21e8b575d4",symbol:"pvIP",decimals:18,chain:[r.yg.id]},{address:"0xADb174564F9065ce497a2Ff8BEC62b21e8b575d7",symbol:"yvIP",decimals:18,chain:[r.yg.id]},{address:"0xADb174564F9065ce497a2Ff8BEC62b21e8b575d5",symbol:"LPvIP",decimals:18,chain:[r.yg.id]},{address:"0xADb174564F9065ce497a2Ff8BEC62b21e8b575d6",symbol:"bvIP",decimals:18,chain:[r.yg.id]},{address:"0x5267F7eE069CEB3D8F1c760c215569b79d0685aE",symbol:"WIP",decimals:18,chain:[r.yg.id]},{address:"0xb09a8ba59615a552231cefcee80c3b88706597ed",symbol:"YTK",decimals:18,chain:[o.F.id]},{address:"0xf37b6ec18cee80634de01aef83701d6e726e7fc9",symbol:"BT-INFRA",decimals:18,chain:[o.F.id]},{address:"0xfa9eeeaf51a053bfb94643ad3d80837c661d99eb",symbol:"YTK",decimals:18,chain:[l.Y.id]},{address:"0x8eeca063d0ec83b98f6af9008c535b1ca2c03e93",symbol:"BT-INFRA",decimals:18,chain:[l.Y.id]},{address:"0xd5255Cc08EBAf6D54ac9448822a18d8A3da29A42",symbol:"AIDaUSDC",decimals:6,chain:[r.yg.id]},{address:"0xF1815bd50389c46847f0Bda824eC8da914045D14",symbol:"USDC",decimals:6,chain:[r.yg.id]},{address:"0x66B4CB07229EcCC6f48161DfcC229Ac06af25457",symbol:"pAIDaUSDC",decimals:6,chain:[r.yg.id]},{address:"0x67B7B0B3fA057703E077D1Df6b50065a1229D41A",symbol:"pAIDaUSDC",decimals:6,chain:[r.yg.id]}],c=u.reduce((e,t)=>t.chain.reduce((e,a)=>({...e,["".concat(a,"_").concat(t.address.toLowerCase())]:t}),e),{});function getTokenBy(e,t,a){if(!e||!t)return;let n=c["".concat(t,"_").concat(e.toLowerCase())];if(!n){let{symbol:n="Token",decimals:s=18,isNative:o}=null!=a?a:{};return{address:e,chain:[t],symbol:n,decimals:s,isNative:o}}return n}},40292:function(e,t,a){a.d(t,{LF:function(){return y},Zi:function(){return useBVaultUnderlyingAPY},tY:function(){return useBvaultROI}});var n=a(43213),s=a(53414),o=a(96555),l=a(62628),r=a(44100),u=a(64370),c=a(83978),i=a.n(c),d=a(74724),p=a(93233),f=a(29332),B=a(44964);let b=(0,d.V)(["struct UserStakeAmountDetail { address stakeTokenAddress; uint256 amount; uint8 lockup; uint256 lastStakeTimestamp;}","function getUserStakeAmountForIP(address _ipAsset, address _user) external view returns (UserStakeAmountDetail[][] memory)","function getTotalStakeWeightedInIPForIP(address _ipAsset) external view returns (uint256)","function getTotalStakeAmountForIP(address _ipAsset, address[] calldata _stakeTokens) external view returns (uint256[] memory)","struct RewardPoolState {address rewardToken;uint8 rewardTokenType;uint8 distributionType;uint256 rewardsPerEpoch;uint256 rewardPerToken;uint256 totalRewards;uint256 totalDistributedRewards;uint256 lastEpochBlock;}","function getRewardPools(address _ipAsset) external view returns (RewardPoolState[][] memory)","function calculateIPWithdrawal(uint256 _vIPToBurn) external view returns (uint256)"]),y={"0xB1D831271A68Db5c18c8F0B69327446f7C8D0A42":"IPPY","0x0a0466c312687027E2BEa065d4Cca0DCEC19bb2C":"Globkins","0xCdF104e4F24d593E16B9F6c382cEB1FB5573EEDd":"Mimboku","0x8c40Ef7408D6036Dca0b69E67D960dd48014cB16":"Sofamon","0x00e23f81e489E43484B0B8Bc109faD6C1F4c28E7":"Benjamin","0x42A351E005De1330DeDe69Ca4Ae1B06715a2f4fA":"WTF"};function useBVaultUnderlyingAPY(e){var t;let a=e.vault,{data:r}=(t="vIP"===e.assetSymbol?a:void 0,(0,u.a)({initialData:[],queryKey:["bvualtipassets",t],enabled:!!t,queryFn:async()=>{let e=await (0,l.B)().readContract({abi:n.j5,address:t,functionName:"ipAssets"});return console.info("ipAssets:",e),e}}));return(0,u.a)({initialData:{avrageApy:0n,items:[]},queryKey:["bvualtunderlyingapy",a,r],enabled:!!a&&r.length>0&&"vIP"==e.assetSymbol,gcTime:36e5,queryFn:async()=>{let t=(0,l.B)((0,s.BV)(),1),n=await t.readContract({abi:b,address:"0xf6701A6A20639f0E765bA7FF66FD4f49815F1a27",functionName:"calculateIPWithdrawal",args:[(0,p.f)("1")]}),u=(0,p.f)("2.367"),apyByIpAsset=async s=>{let[[l],r]=await Promise.all([t.readContract({abi:b,functionName:"getTotalStakeAmountForIP",address:e.ipAssetStaking,args:[s,[e.asset]]}),t.readContract({abi:b,functionName:"getTotalStakeWeightedInIPForIP",address:e.ipAssetStaking,args:[s]})]),c=(0,p.f)("0.00009"),i=r>0n?c*o.SH*o.Pq/u*o.Pq/r:0n;l>=(0,p.f)("100")&&n>0n&&r>0n&&(i+=(0,p.f)("7.5")*o.Pq/n*(l*o.Pq/r)/o.Pq/100n);let d=4n*i;return console.info("underlyingApy:",a,s,(0,f.d)(d)),d},c=await Promise.all(r.map(apyByIpAsset)),i=await Promise.all(r.map(n=>t.readContract({abi:b,functionName:"getUserStakeAmountForIP",address:e.ipAssetStaking,args:[n,a]}))),d=i.map(e=>{var t;return null===(t=e.find(e=>e.length))||void 0===t?void 0:t.find(e=>!!e)}),B=d.reduce((e,t)=>e+((null==t?void 0:t.amount)||0n),0n),m=B>0n?c.map((e,t)=>{var a;return e*((null==d?void 0:null===(a=d[t])||void 0===a?void 0:a.amount)||0n)}).reduce((e,t)=>e+t,0n)/B:0n,A=c.map((e,t)=>{var a;return{apy:e,staked:(null==d?void 0:null===(a=d[t])||void 0===a?void 0:a.amount)||0n,ipID:r[t],tit:y[r[t]]}}).sort((e,t)=>{let a=t.apy-e.apy;return a>0n?1:a<0n?-1:0});return console.info("staked:",a,d,m),{avrageApy:m,items:A}}})}function calcRestakingApy(e,t,a,n,s){let l=t*e*a/o.Pq/o.SH,r=n>0n?l*o.Pq/n:0n,u=s>0n?r*o.Pq/s:0n;return u}function calcAdditionalApy(e,t,a,n){let s=e+t*a,l=0n*o.Pq,r=s>0n?l*o.Pq/s:0n,u=o.Pq*a,c=r*u/o.Pq,i=n>0n?c*o.Pq/n:0n;return i}function calcAdditionalApy2(e,t,a){let n=0n*o.Pq,s=e>0n?n*o.Pq/e:0n,l=o.Pq*t,r=s*l/o.Pq,u=a>0n?r*o.Pq/a:0n;return u}function useBvaultROI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n,s=e.vault,c=(0,r.nr)(s),{data:{avrageApy:d}}=useBVaultUnderlyingAPY(e),p=c.current.yTokenAmountForSwapYT,f=c.current.vaultYTokenBalance,b=c.current.duration+c.current.startTime-BigInt(i().round(i().now()/1e3)),y=c.pTokenTotal,m=f>0n?c.Y*o.Pq/f:0n,A=calcRestakingApy(d,y,b,p,m),P=t>0n?calcRestakingApy(d,y,b,p+t,a):0n,{data:v}=function(e){let t=(0,r.nr)(e);return(0,u.a)({initialData:0n,gcTime:36e5,queryKey:["ytPoints",e,t.current.adhocBribesPool],enabled:!!e&&!!t.current.adhocBribesPool,queryFn:async()=>{let e=(0,l.B)();return t.current.adhocBribesPool===B.DR?0n:e.readContract({abi:n.q3,address:t.current.adhocBribesPool,functionName:"totalSupply"})}})}(s),S=e.pTokenV2?calcAdditionalApy2(c.ytPointsMaxTotalSupply,b,m):calcAdditionalApy(v,p,b,m),h=t>0n?e.pTokenV2?calcAdditionalApy2(c.ytPointsMaxTotalSupply+t*b,b,a):calcAdditionalApy(v,p+t,b,a):0n;return{roi:A>0n?A+S-o.Pq:0n,roiChange:P>0n?P+h-o.Pq:0n,restakingIncomesApy:A,additionalRoi:S}}},44100:function(e,t,a){a.d(t,{OY:function(){return useBvaultTVL},R3:function(){return useUpBVaultForUserAction},RA:function(){return useUserBVaultEpoches},Vw:function(){return useEpochesData},Zd:function(){return useBVaultEpoches},d6:function(){return useResetBVaultsData},gz:function(){return useCalcClaimable},lL:function(){return calcBVaultPTApy},nr:function(){return useBVault},oU:function(){return useBVaultApy},v7:function(){return useBVaultBoost}});var n=a(96555),s=a(99409),o=a(13854),l=a(29293),r=a(83978),u=a.n(r),c=a(77317),i=a(87621),d=a(32422),p=a(81501);function useResetBVaultsData(){let e=(0,s.p)(),{address:t}=(0,i.m)();(0,c.useEffect)(()=>{},[e]),(0,c.useEffect)(()=>{d.w.getState().sliceUserBVaults.reset()},[t])}function useBVault(e){return(0,d.o)(t=>t.sliceBVaultsStore.bvaults[e]||(0,o.Yb)({current:(0,o.Yb)({},0n)},0n),["sliceBVaultsStore.bvaults.".concat(e)])}function useBvaultTVL(e){let t=useBVault(e.vault),a=p.P[e.asset],s=(0,d.o)(e=>e.sliceTokenStore.prices,["sliceTokenStore.prices"]),o=a&&s[a.base]||0n,l=a&&s[a.quote]||0n,r=t.lpBase||0n,u=t.lpQuote||0n,c=r*o/n.Pq,i=u*l/n.Pq,f=c+i;return 0n===f&&(f=(t.lockedAssetTotal||0n)*(s[e.asset]||0n)/n.Pq),[f,c,i]}function useBVaultEpoches(e){return(0,d.o)(t=>{let a=t.sliceBVaultsStore.bvaults[e];if(!a||a.epochCount<=0n)return[];let n=u().range(1,parseInt((a.epochCount+1n).toString())).reverse(),s=t.sliceBVaultsStore.epoches;return n.map(t=>s["".concat(e,"_").concat(t)]).filter(e=>null!=e)},["sliceBVaultsStore.bvaults.".concat(e),"sliceBVaultsStore.epoches"])}function useUserBVaultEpoches(e){return(0,d.o)(t=>t.sliceUserBVaults.epoches[e]||[],["sliceUserBVaults.epoches.".concat(e)])}function useEpochesData(e){let t=useBVaultEpoches(e),a=useUserBVaultEpoches(e);return(0,c.useMemo)(()=>{let e=a.reduce((e,t)=>({...e,[t.epochId.toString()]:t}),{});return t.map(t=>(0,o.Yb)({...t,...e[t.epochId.toString()]||{bribes:[],sBribes:[],aBribes:[]}},0n))},[t,a])}function useCalcClaimable(e){let t=useEpochesData(e);return(0,c.useMemo)(()=>{let e=t.filter(e=>e.claimableAssetBalance&&e.settled);return{ids:e.map(e=>e.epochId),claimable:e.reduce((e,t)=>e+t.claimableAssetBalance,0n)}},[t])}function useBVaultBoost(e){let t=(0,d.o)(()=>(function(e){let t=d.w.getState(),a=t.sliceBVaultsStore.bvaults[e],s=(null==a?void 0:a.current.vaultYTokenBalance)||0n,o=(null==a?void 0:a.Y)||0n,r=o>0n?s*n.Pq/o:0n,u=(null==a?void 0:a.current.yTokenAmountForSwapYT)||0n,c=(null==a?void 0:a.lockedAssetTotal)||0n,i=u>0n?c*n.Pq/u:0n;return console.info("calcBootst:",(0,l.d)(r),(0,l.d)(i)),n.Pq,r})(e),["sliceBVaultsStore.bvaults.".concat(e)]);return[(0,l.d)(t,0),t]}function calcBVaultPTApy(e){let t=d.w.getState(),a=t.sliceBVaultsStore.bvaults[e.vault],s=(0,o.ok)(t.sliceBVaultsStore.yTokenSythetic,[e.vault]),l=0n;return l=e.pTokenV2?a&&a.ptRebaseRate&&a.pTokenTotal?a.ptRebaseRate/n.Pq*n.SH*BigInt(1e10)/a.pTokenTotal/n.Pq:0n:a&&a.current.assetTotalSwapAmount&&s?a.current.assetTotalSwapAmount*n.SH*BigInt(1e10)/s:0n,console.info("apy:",e.vault,l,e.pTokenV2,null==a?void 0:a.ptRebaseRate,null==a?void 0:a.pTokenTotal),l}function useBVaultApy(e){let t=(0,d.o)(()=>calcBVaultPTApy(e),["sliceBVaultsStore.bvaults.".concat(e.vault),"sliceBVaultsStore.yTokenSythetic.".concat(e.vault)]);return[(0,o.Jh)(t,10),t]}function useUpBVaultForUserAction(e,t){let{address:a}=(0,i.m)();return()=>{(0,o.XD)(async()=>{if(null==t||t(),!a)return;await Promise.all([d.w.getState().sliceTokenStore.updateTokensBalance([e.asset,e.pToken],a),d.w.getState().sliceTokenStore.updateTokenTotalSupply([e.asset,e.pToken]),d.w.getState().sliceBVaultsStore.updateBvaults([e]),d.w.getState().sliceBVaultsStore.updateYTokenSythetic([e])]);let n=d.w.getState().sliceBVaultsStore.bvaults[e.vault];await d.w.getState().sliceBVaultsStore.updateEpoches(e,n.epochCount>1n?[n.epochCount,n.epochCount-1n]:[n.epochCount]);let s=[];for(let t=parseInt(n.epochCount.toString());t>0;t--){let a=d.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(t)];s.push(a)}console.info("onUserAction:epoches",s),await d.w.getState().sliceUserBVaults.updateEpoches(e,a,s)},3,1e3)}}}}]);